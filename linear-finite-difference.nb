(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     74073,       1627]
NotebookOptionsPosition[     72802,       1595]
NotebookOutlinePosition[     73176,       1611]
CellTagsIndexPosition[     73133,       1608]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Initialization", "Section",
 CellChangeTimes->{{3.8828823469078555`*^9, 
  3.882882349237961*^9}},ExpressionUUID->"42108651-6b61-4a1e-bd67-\
8bc5b7bfbc1c"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   StyleBox[
    RowBox[{"myPrint", "[", 
     RowBox[{"msg_", ",", "rest_"}], "]"}], "Input"], 
   StyleBox[":=", "Input"], 
   RowBox[{
    StyleBox["Print", "Input"], "[", 
    RowBox[{"StringForm", "@@", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"msg", ",", "rest"}], "}"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 StyleBox[
  RowBox[{
   RowBox[{"g", "=", "9.81"}], ";"}], "Input"], "\[IndentingNewLine]", 
 StyleBox[
  RowBox[{
   RowBox[{
    RowBox[{"l", "=", "1"}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"Pool", " ", "length"}], "*)"}]}], 
  "Input"], "\[IndentingNewLine]", 
 StyleBox[
  RowBox[{
   RowBox[{
    RowBox[{"h", "=", "0.3"}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"Pool", " ", "depth"}], "*)"}]}], "Input"], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tMax", "=", "1"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"True", " ", "\[Rule]", " ", 
     RowBox[{"use", " ", "number", " ", "of", " ", "intervals"}]}], ",", " ", 
    RowBox[{
     RowBox[{"compute", " ", "the", " ", "step"}], ";", "\[IndentingNewLine]", 
     RowBox[{"False", " ", "\[Rule]", " ", 
      RowBox[{"use", " ", "the", " ", "step", " ", "size"}]}]}], ",", " ", 
    RowBox[{"compute", " ", "number", " ", "of", " ", "intervals"}]}], 
   "\[IndentingNewLine]", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"useNIntervals", "=", "False"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"If", "[", 
  RowBox[{"useNIntervals", ",", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xIntervals", "=", "100"}], ";", "\[IndentingNewLine]", 
     RowBox[{"zIntervals", "=", "40"}], ";"}], "\[IndentingNewLine]", ")"}], 
   ",", 
   RowBox[{"(*", "else", "*)"}], " ", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"stepTarget", "=", "0.01"}], ";", "\[IndentingNewLine]", 
     RowBox[{"xIntervals", "=", 
      RowBox[{"Ceiling", "[", 
       RowBox[{"l", "/", "stepTarget"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"zIntervals", "=", 
      RowBox[{"Ceiling", "[", 
       RowBox[{"h", "/", "stepTarget"}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", ")"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", 
   RowBox[{"xIntervals", "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"m", "=", 
   RowBox[{"zIntervals", "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"numNodes", "=", 
   RowBox[{"n", "*", "m"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]x", "=", 
   RowBox[{"N", "[", 
    RowBox[{"l", "/", "xIntervals"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[CapitalDelta]z", "=", 
    RowBox[{"N", "[", 
     RowBox[{"h", "/", "zIntervals"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"\[Tau]", "=", 
     RowBox[{
      RowBox[{"Min", "[", 
       RowBox[{"\[CapitalDelta]x", ",", "\[CapitalDelta]z"}], "]"}], "^", 
      "2"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Tau]", "=", "0.01"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tIntervals", "=", 
   RowBox[{"Ceiling", "[", 
    RowBox[{"tMax", "/", "\[Tau]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", "=", 
   RowBox[{"tIntervals", "+", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Tau]", "=", 
   RowBox[{"N", "[", 
    RowBox[{"tMax", "/", "tIntervals"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xCoord", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"\[CapitalDelta]x", 
      RowBox[{"(", 
       RowBox[{"i", "-", "1"}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zCoord", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"\[CapitalDelta]z", 
      RowBox[{"(", 
       RowBox[{"i", "-", "1"}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "m"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tCoord", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"\[Tau]", 
      RowBox[{"(", 
       RowBox[{"i", "-", "1"}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "t"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"index", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"1", "+", 
      RowBox[{"(", 
       RowBox[{"i", "-", "1"}], ")"}], " ", "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"j", "-", "1"}], ")"}], "n"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "m"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"myPrint", "[", 
   RowBox[{"\"\<Number of points X,Z,T = (``, ``, ``)\>\"", ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "m", ",", "t"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"myPrint", "[", 
    RowBox[{
    "\"\<\[CapitalDelta]x,\[CapitalDelta]z,\[Tau] = (``, ``, ``)\>\"", ",", 
     RowBox[{"{", 
      RowBox[{"\[CapitalDelta]x", ",", "\[CapitalDelta]z", ",", "\[Tau]"}], 
      "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Surface", " ", "variable"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hInitial", "[", "x_", "]"}], ":=", 
   RowBox[{
    FractionBox["1", 
     RowBox[{
      RowBox[{"(", "0.2", ")"}], "2", "\[Pi]"}]], 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "0.5"}], 
      RowBox[{
       RowBox[{"(", 
        FractionBox[
         RowBox[{
          RowBox[{"x", "/", "l"}], "-", "0.3"}], "0.05"], ")"}], "^", "2"}]}],
      "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fVal", "=", 
   RowBox[{
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{"hInitial", "[", "x", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "0", ",", "l"}], "}"}]}], "]"}], "/", "l"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"hNorm", "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"hInitial", "[", "x", "]"}], "-", "fVal"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Matrix", " ", "helper"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"centerIdx", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"leftIdx", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rightIdx", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bottomIdx", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"topIdx", "=", "5"}], ";"}]}], "Input",
 CellChangeTimes->{{3.882881189569041*^9, 3.882881285039916*^9}, {
   3.882881699417963*^9, 3.8828817510591793`*^9}, {3.882881886518013*^9, 
   3.882882120667685*^9}, {3.8828822690676193`*^9, 3.8828823081074862`*^9}, {
   3.8828824010573215`*^9, 3.8828824036082664`*^9}, {3.882882490807102*^9, 
   3.882882565956889*^9}, {3.8828826229169483`*^9, 3.882882823606498*^9}, {
   3.883229277511205*^9, 3.8832293606703324`*^9}, {3.8832294047266674`*^9, 
   3.883229407650838*^9}, {3.8832294439840136`*^9, 3.883229490901822*^9}, {
   3.883229551871355*^9, 3.883229553433442*^9}, {3.8832296002918777`*^9, 
   3.8832296713901415`*^9}, {3.883230225452199*^9, 3.883230236453184*^9}, {
   3.8832302824289927`*^9, 3.8832303845022154`*^9}, {3.8832304157291336`*^9, 
   3.883230418899759*^9}, {3.8832305321625156`*^9, 3.883230648135902*^9}, {
   3.8832306922321787`*^9, 3.883231027388382*^9}, {3.8832311024703827`*^9, 
   3.8832311073115196`*^9}, {3.883231504019458*^9, 3.8832316120118876`*^9}, {
   3.8832316442243385`*^9, 3.8832317850550585`*^9}, {3.883231822717415*^9, 
   3.8832318256693783`*^9}, {3.883231863611047*^9, 3.8832318660479465`*^9}, {
   3.8832319100923834`*^9, 3.883231918240924*^9}, {3.883231972040289*^9, 
   3.8832319859749436`*^9}, {3.8832320301535716`*^9, 3.883232030825303*^9}, {
   3.8832320764264746`*^9, 3.8832321431317053`*^9}, {3.8832323811955166`*^9, 
   3.883232383179262*^9}, {3.8832332753874083`*^9, 3.883233301665714*^9}, {
   3.883233607300892*^9, 3.883233729753194*^9}, {3.8832340378118873`*^9, 
   3.883234039281787*^9}, {3.8832341271326303`*^9, 3.8832341923303413`*^9}, {
   3.88323494626569*^9, 3.8832350204534082`*^9}, {3.883235892256832*^9, 
   3.883235908713058*^9}, {3.8833734074209833`*^9, 3.883373443720086*^9}, 
   3.883373476647803*^9, 3.8833735763633313`*^9, {3.883388703694976*^9, 
   3.8833887121640587`*^9}, {3.883392814600442*^9, 3.8833928416408587`*^9}, {
   3.88339339830197*^9, 3.883393400879373*^9}, {3.883400916773037*^9, 
   3.88340091730602*^9}, {3.8834034225346975`*^9, 3.883403463355422*^9}, {
   3.883404137896467*^9, 3.8834041679198155`*^9}, {3.883405180049349*^9, 
   3.8834052040991335`*^9}, 3.8834095887739196`*^9, {3.8834098834349403`*^9, 
   3.883409883638031*^9}, {3.8834101602142787`*^9, 3.883410234687046*^9}, 
   3.883410267240859*^9, {3.8834116975103626`*^9, 3.8834117281491528`*^9}, {
   3.8834117930805645`*^9, 3.883411813616927*^9}, 3.8835733122812424`*^9, {
   3.8835733797112107`*^9, 3.883573379905548*^9}, 3.8835734229913073`*^9, {
   3.883577267315708*^9, 3.8835773176108828`*^9}, {3.8836533629249134`*^9, 
   3.8836534022550354`*^9}, {3.8836553306319695`*^9, 
   3.8836553312811623`*^9}, {3.883656807852338*^9, 3.8836568080781116`*^9}, {
   3.8836574579088354`*^9, 3.883657461508005*^9}, 3.883657513028308*^9, 
   3.883657550992952*^9, {3.8836576501729927`*^9, 3.883657655418036*^9}, {
   3.883657742833256*^9, 3.8836577454907207`*^9}, {3.8836580168794155`*^9, 
   3.8836580633887625`*^9}, {3.883659284024026*^9, 3.8836592877728615`*^9}, 
   3.883659462161868*^9, {3.8836597649010334`*^9, 3.883659790211153*^9}, {
   3.8836599414107876`*^9, 3.8836599960502415`*^9}, {3.883660350990017*^9, 
   3.8836603582900705`*^9}, {3.883662156726635*^9, 3.883662160125948*^9}, 
   3.883662203765709*^9, {3.883662250556717*^9, 3.883662257755525*^9}, {
   3.883662495595612*^9, 3.8836625397054014`*^9}, {3.8836625899260306`*^9, 
   3.8836626247751455`*^9}, {3.8854581328283644`*^9, 
   3.8854581357024803`*^9}, {3.885482334290002*^9, 3.8854823349572973`*^9}, {
   3.88548236691887*^9, 3.8854823670212955`*^9}, {3.885482702093149*^9, 
   3.885482702152315*^9}, {3.8854828969127483`*^9, 3.8854828975358906`*^9}, {
   3.885482954133153*^9, 3.8854829547505984`*^9}, {3.8857180885052347`*^9, 
   3.8857180887454863`*^9}, 3.885721501917775*^9, 3.885721620327714*^9, 
   3.8857240401102805`*^9, 3.88572425406752*^9, {3.8857320163155537`*^9, 
   3.8857320234021597`*^9}, {3.8857330532117043`*^9, 3.885733099238574*^9}, {
   3.885738729251484*^9, 3.885738734301261*^9}, {3.885739560163545*^9, 
   3.885739560252513*^9}, 3.88573964509025*^9, {3.885739783919531*^9, 
   3.885739808712557*^9}, {3.8857400388760676`*^9, 3.8857400390601034`*^9}, {
   3.8857400706647525`*^9, 3.8857400969688077`*^9}, 3.885740145850484*^9, {
   3.8857403574598913`*^9, 3.88574039059999*^9}, {3.8857899640388994`*^9, 
   3.885789974733263*^9}, 3.8857903412111454`*^9, {3.8857906422924547`*^9, 
   3.885790675624194*^9}, {3.8857907865184784`*^9, 3.8857908132352195`*^9}, 
   3.8857908640990143`*^9, {3.885790905431035*^9, 3.885790906955785*^9}, 
   3.885790945947825*^9, 3.88579097641265*^9, 3.8857910095522504`*^9, {
   3.885791099472874*^9, 3.885791101479375*^9}, 3.885791151816182*^9, 
   3.8857912072708673`*^9, 3.885791251152379*^9, {3.8858202541150217`*^9, 
   3.885820267499713*^9}},
 CellLabel->
  "In[1350]:=",ExpressionUUID->"a11c82e2-ee0a-4188-940e-f76bf6862d06"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox["\<\"Number of points X,Z,T = \
(\\!\\(\\*RowBox[{\\\"101\\\"}]\\), \\!\\(\\*RowBox[{\\\"31\\\"}]\\), \
\\!\\(\\*RowBox[{\\\"101\\\"}]\\))\"\>",
  StringForm["Number of points X,Z,T = (``, ``, ``)", 101, 31, 101],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.883380141843087*^9, 3.8833876949522295`*^9, 3.8833879104511805`*^9, 
   3.8833887243824525`*^9, 3.883392739032254*^9, 3.883392845220729*^9, 
   3.8833934041283083`*^9, 3.8834009185127754`*^9, 3.8834016903782167`*^9, 
   3.883403465578071*^9, 3.883404174214508*^9, 3.8834044987807865`*^9, {
   3.8834051970450525`*^9, 3.883405204451233*^9}, 3.883409884966028*^9, 
   3.8834099411572657`*^9, {3.8834101903504148`*^9, 3.88341023520263*^9}, 
   3.8834102680689096`*^9, {3.8834116998226857`*^9, 3.8834117286803455`*^9}, {
   3.8834118036414127`*^9, 3.8834118139762383`*^9}, 3.883572967562973*^9, 
   3.8835733148608446`*^9, 3.8835733806706553`*^9, 3.8835734234509563`*^9, 
   3.883577318118595*^9, {3.8836533717646217`*^9, 3.883653403285056*^9}, 
   3.8836535432044687`*^9, 3.883654145783287*^9, 3.8836548186618614`*^9, 
   3.883655336610918*^9, 3.8836568086283913`*^9, 3.8836574635315075`*^9, 
   3.8836575134122906`*^9, 3.883657551394735*^9, 3.883657655933015*^9, 
   3.883657747059085*^9, 3.8836580648516393`*^9, 3.8836592957894063`*^9, 
   3.883659466431018*^9, 3.883659790980335*^9, {3.883659969850129*^9, 
   3.883659996599996*^9}, 3.8836603598442507`*^9, 3.883662167615987*^9, 
   3.883662204165801*^9, 3.8836622580358353`*^9, {3.8836625015153933`*^9, 
   3.883662540105082*^9}, {3.883662600980259*^9, 3.883662625035368*^9}, 
   3.885458142224827*^9, 3.885482335898533*^9, 3.8854823677493515`*^9, 
   3.885482703246191*^9, 3.8854828981655445`*^9, 3.885482956173879*^9, 
   3.8856413208870363`*^9, 3.885646960092205*^9, 3.88571808918552*^9, 
   3.885721502177598*^9, 3.8857216209285393`*^9, 3.8857239711954713`*^9, 
   3.8857240413072815`*^9, 3.8857242544490757`*^9, 3.8857306373696084`*^9, {
   3.885732021529282*^9, 3.885732023632028*^9}, {3.8857330749659743`*^9, 
   3.885733099895838*^9}, {3.885738730613025*^9, 3.885738734934843*^9}, 
   3.8857391399451838`*^9, 3.885739561054482*^9, 3.885739645928588*^9, {
   3.8857397841623154`*^9, 3.885739809391658*^9}, 3.8857398451016784`*^9, 
   3.885740039546893*^9, {3.8857400713104467`*^9, 3.885740097782836*^9}, 
   3.885740146799017*^9, {3.885740360493536*^9, 3.8857403911813745`*^9}, {
   3.8857899652618413`*^9, 3.8857899750692787`*^9}, 3.885790341527747*^9, {
   3.8857906679304457`*^9, 3.8857906758803596`*^9}, {3.8857907868888516`*^9, 
   3.885790813854558*^9}, 3.885790865040529*^9, 3.8857909076693945`*^9, 
   3.8857909466607933`*^9, 3.8857909770260878`*^9, 3.885791010270085*^9, 
   3.8857911018272495`*^9, 3.8857911524025364`*^9, 3.885791207803934*^9, 
   3.8857912518248277`*^9, 3.885820268119363*^9},
 CellLabel->
  "During evaluation of \
In[1350]:=",ExpressionUUID->"732b2cef-b81b-464a-bf2d-44d83ed024d0"],

Cell[BoxData[
 InterpretationBox["\<\"\[CapitalDelta]x,\[CapitalDelta]z,\[Tau] = \
(\\!\\(\\*RowBox[{\\\"0.01`\\\"}]\\), \\!\\(\\*RowBox[{\\\"0.01`\\\"}]\\), \
\\!\\(\\*RowBox[{\\\"0.01`\\\"}]\\))\"\>",
  StringForm[
  "\[CapitalDelta]x,\[CapitalDelta]z,\[Tau] = (``, ``, ``)", 0.01, 0.01, 0.01],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.883380141843087*^9, 3.8833876949522295`*^9, 3.8833879104511805`*^9, 
   3.8833887243824525`*^9, 3.883392739032254*^9, 3.883392845220729*^9, 
   3.8833934041283083`*^9, 3.8834009185127754`*^9, 3.8834016903782167`*^9, 
   3.883403465578071*^9, 3.883404174214508*^9, 3.8834044987807865`*^9, {
   3.8834051970450525`*^9, 3.883405204451233*^9}, 3.883409884966028*^9, 
   3.8834099411572657`*^9, {3.8834101903504148`*^9, 3.88341023520263*^9}, 
   3.8834102680689096`*^9, {3.8834116998226857`*^9, 3.8834117286803455`*^9}, {
   3.8834118036414127`*^9, 3.8834118139762383`*^9}, 3.883572967562973*^9, 
   3.8835733148608446`*^9, 3.8835733806706553`*^9, 3.8835734234509563`*^9, 
   3.883577318118595*^9, {3.8836533717646217`*^9, 3.883653403285056*^9}, 
   3.8836535432044687`*^9, 3.883654145783287*^9, 3.8836548186618614`*^9, 
   3.883655336610918*^9, 3.8836568086283913`*^9, 3.8836574635315075`*^9, 
   3.8836575134122906`*^9, 3.883657551394735*^9, 3.883657655933015*^9, 
   3.883657747059085*^9, 3.8836580648516393`*^9, 3.8836592957894063`*^9, 
   3.883659466431018*^9, 3.883659790980335*^9, {3.883659969850129*^9, 
   3.883659996599996*^9}, 3.8836603598442507`*^9, 3.883662167615987*^9, 
   3.883662204165801*^9, 3.8836622580358353`*^9, {3.8836625015153933`*^9, 
   3.883662540105082*^9}, {3.883662600980259*^9, 3.883662625035368*^9}, 
   3.885458142224827*^9, 3.885482335898533*^9, 3.8854823677493515`*^9, 
   3.885482703246191*^9, 3.8854828981655445`*^9, 3.885482956173879*^9, 
   3.8856413208870363`*^9, 3.885646960092205*^9, 3.88571808918552*^9, 
   3.885721502177598*^9, 3.8857216209285393`*^9, 3.8857239711954713`*^9, 
   3.8857240413072815`*^9, 3.8857242544490757`*^9, 3.8857306373696084`*^9, {
   3.885732021529282*^9, 3.885732023632028*^9}, {3.8857330749659743`*^9, 
   3.885733099895838*^9}, {3.885738730613025*^9, 3.885738734934843*^9}, 
   3.8857391399451838`*^9, 3.885739561054482*^9, 3.885739645928588*^9, {
   3.8857397841623154`*^9, 3.885739809391658*^9}, 3.8857398451016784`*^9, 
   3.885740039546893*^9, {3.8857400713104467`*^9, 3.885740097782836*^9}, 
   3.885740146799017*^9, {3.885740360493536*^9, 3.8857403911813745`*^9}, {
   3.8857899652618413`*^9, 3.8857899750692787`*^9}, 3.885790341527747*^9, {
   3.8857906679304457`*^9, 3.8857906758803596`*^9}, {3.8857907868888516`*^9, 
   3.885790813854558*^9}, 3.885790865040529*^9, 3.8857909076693945`*^9, 
   3.8857909466607933`*^9, 3.8857909770260878`*^9, 3.885791010270085*^9, 
   3.8857911018272495`*^9, 3.8857911524025364`*^9, 3.885791207803934*^9, 
   3.8857912518248277`*^9, 3.885820268123344*^9},
 CellLabel->
  "During evaluation of \
In[1350]:=",ExpressionUUID->"9f40f3fe-65ad-4da2-b6da-a1222a797fec"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Linear system of equations", "Section",
 CellChangeTimes->{{3.883373588923236*^9, 3.8833735905636816`*^9}, {
  3.8833783804476204`*^9, 
  3.883378383455702*^9}},ExpressionUUID->"6d7d3f2f-12aa-4bbe-9371-\
8bdcba80fc8b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"buildMatrix", "[", "tIndex_Integer", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", "j", ",", "result", ",", "center", ",", "left", ",", "right", 
       ",", "bottom", ",", "top", ",", "mainIdx", ",", "tg"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Sparce", " ", 
       RowBox[{"matrix", ".", " ", "We"}], " ", "only", " ", "need", " ", 
       "the", " ", "center", " ", "and", " ", "4", " ", "neighbors", " ", 
       "from", " ", "each", " ", "cell"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"result", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", "numNodes", ",", "5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Add", " ", "contributions", " ", "to", " ", "nodes", " ", "below", 
        " ", "the", " ", "free", " ", "surface"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"m", "-", "1"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "\[LessEqual]", "n"}], ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"center", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "2.0"}], 
               RowBox[{"(", 
                RowBox[{"\[CapitalDelta]x", "/", "\[CapitalDelta]z"}], 
                ")"}]}], "-", 
              RowBox[{"2.0", 
               RowBox[{"(", 
                RowBox[{"\[CapitalDelta]z", "/", "\[CapitalDelta]x"}], 
                ")"}]}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"left", "=", 
             RowBox[{"right", "=", 
              RowBox[{"\[CapitalDelta]z", "/", "\[CapitalDelta]x"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"top", "=", 
             RowBox[{"bottom", "=", 
              RowBox[{"\[CapitalDelta]x", "/", "\[CapitalDelta]z"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Left", " ", "boundary"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"right", "+=", "left"}], ";", "\[IndentingNewLine]", 
               RowBox[{"left", "=", "0"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[Equal]", "n"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Right", " ", "boundary"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"left", "+=", "right"}], ";", "\[IndentingNewLine]", 
               RowBox[{"right", "=", "0"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"j", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Bottom", " ", "boundary"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"top", "+=", "bottom"}], ";", "\[IndentingNewLine]", 
               RowBox[{"bottom", "=", "0"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"mainIdx", "=", 
             RowBox[{"index", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", 
               RowBox[{"mainIdx", ",", "centerIdx"}], "]"}], "]"}], "=", 
             "center"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", 
               RowBox[{"mainIdx", ",", "leftIdx"}], "]"}], "]"}], "=", 
             "left"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", 
               RowBox[{"mainIdx", ",", "rightIdx"}], "]"}], "]"}], "=", 
             "right"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", 
               RowBox[{"mainIdx", ",", "bottomIdx"}], "]"}], "]"}], "=", 
             "bottom"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", 
               RowBox[{"mainIdx", ",", "topIdx"}], "]"}], "]"}], "=", "top"}],
             ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Add", " ", "contributions", " ", "to", " ", "nodes", " ", "on", " ", 
        "the", " ", "free", " ", "surface"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tg", "=", 
       RowBox[{
        SuperscriptBox["\[Tau]", "2"], "g"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "n"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"center", "=", 
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{"4", "+", 
             FractionBox["tg", "\[CapitalDelta]z"], "+", 
             FractionBox[
              RowBox[{"tg", " ", "\[CapitalDelta]z"}], 
              SuperscriptBox["\[CapitalDelta]x", "2"]]}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"left", "=", 
          RowBox[{"right", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"tg", " ", "\[CapitalDelta]z"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"2", 
              SuperscriptBox["\[CapitalDelta]x", "2"]}], ")"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bottom", "=", 
          RowBox[{"tg", "/", "\[CapitalDelta]z"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"top", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Left", " ", "boundary"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"right", "+=", "left"}], ";", "\[IndentingNewLine]", 
            RowBox[{"left", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "n"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Right", " ", "boundary"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"left", "+=", "right"}], ";", "\[IndentingNewLine]", 
            RowBox[{"right", "=", "0"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"mainIdx", "=", 
          RowBox[{"index", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "m"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "[", 
           RowBox[{"[", 
            RowBox[{"mainIdx", ",", "centerIdx"}], "]"}], "]"}], "=", 
          "center"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "[", 
           RowBox[{"[", 
            RowBox[{"mainIdx", ",", "leftIdx"}], "]"}], "]"}], "=", "left"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "[", 
           RowBox[{"[", 
            RowBox[{"mainIdx", ",", "rightIdx"}], "]"}], "]"}], "=", 
          "right"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "[", 
           RowBox[{"[", 
            RowBox[{"mainIdx", ",", "bottomIdx"}], "]"}], "]"}], "=", 
          "bottom"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "[", 
           RowBox[{"[", 
            RowBox[{"mainIdx", ",", "topIdx"}], "]"}], "]"}], "=", "top"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "result", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"buildRightSide", "[", 
    RowBox[{"tIndex_Integer", ",", "\[Phi]_", ",", "hi_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"result", ",", "i", ",", "tg", ",", "mainIdx"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"result", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", "numNodes"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Only", " ", "the", " ", "nodes", " ", "on", " ", "the", " ", "free", 
        " ", "surface", " ", "have", " ", "contributions", " ", "here"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tg", "=", 
       RowBox[{"\[Tau]", " ", "g"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "n"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mainIdx", "=", 
          RowBox[{"index", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "m"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"result", "[", 
           RowBox[{"[", "mainIdx", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "4"}], 
            RowBox[{"\[Phi]", "[", 
             RowBox[{"[", "mainIdx", "]"}], "]"}]}], "+", 
           RowBox[{"\[Tau]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"4", " ", "g", " ", 
               RowBox[{"hi", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "\[IndentingNewLine]", "+", 
              RowBox[{
               FractionBox["tg", "\[CapitalDelta]z"], 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Phi]", "[", 
                  RowBox[{"[", "mainIdx", "]"}], "]"}], "-", 
                 RowBox[{"\[Phi]", "[", 
                  RowBox[{"[", 
                   RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"m", "-", "1"}]}], "]"}], "]"}], "]"}], "]"}]}], 
                ")"}]}], "\[IndentingNewLine]", "+", 
              RowBox[{
               FractionBox[
                RowBox[{"tg", " ", "\[CapitalDelta]z"}], 
                SuperscriptBox["\[CapitalDelta]x", "2"]], 
               RowBox[{"\[Phi]", "[", 
                RowBox[{"[", "mainIdx", "]"}], "]"}]}], "\[IndentingNewLine]",
               "-", 
              RowBox[{
               FractionBox[
                RowBox[{"tg", " ", "\[CapitalDelta]z"}], 
                RowBox[{"2", 
                 SuperscriptBox["\[CapitalDelta]x", "2"]}]], 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Phi]", "[", 
                  RowBox[{"[", 
                   RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", ">", "1"}], ",", 
                    RowBox[{"i", "-", "1"}], ",", 
                    RowBox[{"i", "+", "1"}]}], "]"}], ",", "m"}], "]"}], 
                    "]"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Phi]", "[", 
                  RowBox[{"[", 
                   RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", "<", "n"}], ",", 
                    RowBox[{"i", "+", "1"}], ",", 
                    RowBox[{"i", "-", "1"}]}], "]"}], ",", "m"}], "]"}], 
                    "]"}], "]"}], "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
             ")"}]}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "result", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"calcResid", "[", 
    RowBox[{"mat_", ",", "sol_", ",", "rhs_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j", ",", "mainIdx", ",", "res"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"res", "=", "rhs"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "n"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "m"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"mainIdx", "=", 
             RowBox[{"index", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "mainIdx", "]"}], "]"}], "-=", 
             RowBox[{
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{"mainIdx", ",", "centerIdx"}], "]"}], "]"}], 
              RowBox[{"sol", "[", 
               RowBox[{"[", "mainIdx", "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", ">", "1"}], ",", 
              RowBox[{
               RowBox[{"res", "[", 
                RowBox[{"[", "mainIdx", "]"}], "]"}], "-=", 
               RowBox[{
                RowBox[{"mat", "[", 
                 RowBox[{"[", 
                  RowBox[{"mainIdx", ",", "leftIdx"}], "]"}], "]"}], 
                RowBox[{"sol", "[", 
                 RowBox[{"[", 
                  RowBox[{"index", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "j"}], "]"}], "]"}], "]"}], 
                 "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "<", "n"}], ",", 
              RowBox[{
               RowBox[{"res", "[", 
                RowBox[{"[", "mainIdx", "]"}], "]"}], "-=", 
               RowBox[{
                RowBox[{"mat", "[", 
                 RowBox[{"[", 
                  RowBox[{"mainIdx", ",", "rightIdx"}], "]"}], "]"}], 
                RowBox[{"sol", "[", 
                 RowBox[{"[", 
                  RowBox[{"index", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}], "]"}], 
                 "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"j", ">", "1"}], ",", 
              RowBox[{
               RowBox[{"res", "[", 
                RowBox[{"[", "mainIdx", "]"}], "]"}], "-=", 
               RowBox[{
                RowBox[{"mat", "[", 
                 RowBox[{"[", 
                  RowBox[{"mainIdx", ",", "bottomIdx"}], "]"}], "]"}], 
                RowBox[{"sol", "[", 
                 RowBox[{"[", 
                  RowBox[{"index", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}], "]"}], "]"}], 
                 "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"j", "<", "m"}], ",", 
              RowBox[{
               RowBox[{"res", "[", 
                RowBox[{"[", "mainIdx", "]"}], "]"}], "-=", 
               RowBox[{
                RowBox[{"mat", "[", 
                 RowBox[{"[", 
                  RowBox[{"mainIdx", ",", "topIdx"}], "]"}], "]"}], 
                RowBox[{"sol", "[", 
                 RowBox[{"[", 
                  RowBox[{"index", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"j", "+", "1"}]}], "]"}], "]"}], "]"}], 
                 "]"}]}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "res", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"buildInterpolation", "[", 
    RowBox[{"hi_", ",", "xs_", ",", "ts_"}], "]"}], ":=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"xs", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"ts", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"hi", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", "i"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "t"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}], ",", "1"}], 
      "]"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.882881189569041*^9, 3.882881285039916*^9}, {
   3.882881699417963*^9, 3.8828817510591793`*^9}, {3.882881886518013*^9, 
   3.882882120667685*^9}, {3.8828822690676193`*^9, 3.8828823081074862`*^9}, {
   3.8828824010573215`*^9, 3.8828824036082664`*^9}, {3.882882490807102*^9, 
   3.882882565956889*^9}, {3.8828826229169483`*^9, 3.882882823606498*^9}, {
   3.883229277511205*^9, 3.8832293606703324`*^9}, {3.8832294047266674`*^9, 
   3.883229407650838*^9}, {3.8832294439840136`*^9, 3.883229490901822*^9}, {
   3.883229551871355*^9, 3.883229553433442*^9}, {3.8832296002918777`*^9, 
   3.8832296713901415`*^9}, {3.883230225452199*^9, 3.883230236453184*^9}, {
   3.8832302824289927`*^9, 3.8832303845022154`*^9}, {3.8832304157291336`*^9, 
   3.883230418899759*^9}, {3.8832305321625156`*^9, 3.883230648135902*^9}, {
   3.8832306922321787`*^9, 3.883231027388382*^9}, {3.8832311024703827`*^9, 
   3.8832311073115196`*^9}, {3.883231504019458*^9, 3.8832316120118876`*^9}, {
   3.8832316442243385`*^9, 3.8832317850550585`*^9}, {3.883231822717415*^9, 
   3.8832318256693783`*^9}, {3.883231863611047*^9, 3.8832318660479465`*^9}, {
   3.8832319100923834`*^9, 3.883231918240924*^9}, {3.883231972040289*^9, 
   3.8832319859749436`*^9}, {3.8832320301535716`*^9, 3.883232030825303*^9}, {
   3.8832320764264746`*^9, 3.8832321431317053`*^9}, {3.8832323811955166`*^9, 
   3.883232383179262*^9}, {3.8832332753874083`*^9, 3.883233301665714*^9}, {
   3.883233607300892*^9, 3.883233729753194*^9}, {3.8832340378118873`*^9, 
   3.883234039281787*^9}, {3.8832341271326303`*^9, 3.8832341923303413`*^9}, {
   3.88323494626569*^9, 3.8832350204534082`*^9}, {3.883235892256832*^9, 
   3.883235908713058*^9}, {3.8833734074209833`*^9, 3.883373443720086*^9}, 
   3.883373476647803*^9, {3.8833735763633313`*^9, 3.8833736603633595`*^9}, {
   3.8833738127497597`*^9, 3.883373849252986*^9}, {3.88337590752516*^9, 
   3.883375914321137*^9}, {3.8833759578484683`*^9, 3.883375958053809*^9}, {
   3.883376015099761*^9, 3.88337601539322*^9}, {3.883376049040701*^9, 
   3.883376117123602*^9}, {3.8833762065934277`*^9, 3.883376237442164*^9}, {
   3.8833767541536674`*^9, 3.883376827798356*^9}, {3.883377512204432*^9, 
   3.8833775281798134`*^9}, {3.8833776863025627`*^9, 3.883377691834625*^9}, {
   3.8833777426034284`*^9, 3.883377746451758*^9}, {3.883378387588629*^9, 
   3.8833783982076387`*^9}, {3.8833789821725693`*^9, 
   3.8833790381316795`*^9}, {3.883379190590523*^9, 3.883379251030225*^9}, {
   3.8833792853982253`*^9, 3.8833793074428988`*^9}, {3.883379454176201*^9, 
   3.883379668343934*^9}, {3.8833800671985016`*^9, 3.883380088675129*^9}, {
   3.8833802776786957`*^9, 3.8833802778153505`*^9}, {3.8833804765147486`*^9, 
   3.883380652792529*^9}, {3.883381153077964*^9, 3.883381155887357*^9}, {
   3.8833818013131256`*^9, 3.883381887455015*^9}, {3.8833819609827967`*^9, 
   3.883382034354478*^9}, {3.883382066199656*^9, 3.883382100512733*^9}, {
   3.8833875818465233`*^9, 3.883387585779591*^9}, {3.883387641610902*^9, 
   3.8833877715521135`*^9}, {3.8833878279627504`*^9, 
   3.8833879276541038`*^9}, {3.8833881246816745`*^9, 
   3.8833881257796817`*^9}, {3.883388171858305*^9, 3.8833882661562147`*^9}, {
   3.883388313734235*^9, 3.883388420107547*^9}, {3.883388552007233*^9, 
   3.8833885901061373`*^9}, {3.8833886282924147`*^9, 3.883388670913145*^9}, {
   3.88338871740629*^9, 3.8833887342439036`*^9}, {3.883389320256488*^9, 
   3.883389447679038*^9}, {3.883390093911208*^9, 3.883390185180961*^9}, {
   3.8833902426210375`*^9, 3.8833903495455875`*^9}, {3.8833903895755444`*^9, 
   3.8833904318964863`*^9}, {3.883391154929556*^9, 3.8833911788679543`*^9}, {
   3.8833914908779736`*^9, 3.883391704808709*^9}, {3.883391771367667*^9, 
   3.8833918060369587`*^9}, {3.8833918935412617`*^9, 
   3.8833919088647804`*^9}, {3.8833921120479765`*^9, 3.883392146384989*^9}, {
   3.8833922212344475`*^9, 3.8833924487277613`*^9}, {3.883392539285016*^9, 
   3.883392546169037*^9}, {3.883392681698147*^9, 3.883392708644879*^9}, {
   3.8833927721360035`*^9, 3.8833927743480463`*^9}, 3.8833928513635774`*^9, 
   3.8833991458196115`*^9, {3.883403387467227*^9, 3.8834034044133472`*^9}, {
   3.883404180418486*^9, 3.8834042044768467`*^9}, {3.883404325942037*^9, 
   3.8834044160413823`*^9}, {3.883409455628559*^9, 3.883409503315955*^9}, {
   3.8835729920866885`*^9, 3.8835731202952147`*^9}, {3.8835731563412905`*^9, 
   3.883573160850777*^9}, {3.8835747254688325`*^9, 3.8835747506285057`*^9}, {
   3.883574786607718*^9, 3.883574794158851*^9}, {3.883574952638344*^9, 
   3.883575086868224*^9}, {3.8835751644278746`*^9, 3.883575165477632*^9}, {
   3.8835752639176*^9, 3.883575264547702*^9}, {3.8835753524077396`*^9, 
   3.8835753592976484`*^9}, {3.883575471076418*^9, 3.883575482367381*^9}, {
   3.88357564271649*^9, 3.883575652587214*^9}, {3.883575768436837*^9, 
   3.883575768746874*^9}, {3.8835758761460447`*^9, 3.8835759072758293`*^9}, {
   3.883577805905277*^9, 3.8835778120116615`*^9}, {3.88365431896321*^9, 
   3.883654323464834*^9}, {3.8836546700624304`*^9, 3.883654707032442*^9}, {
   3.8836547927029333`*^9, 3.8836548855220623`*^9}, {3.883656723019055*^9, 
   3.8836567513285713`*^9}, {3.883656786249389*^9, 3.8836567908584533`*^9}, 
   3.8836569206981363`*^9, {3.8836569536078596`*^9, 3.883657027857783*^9}, {
   3.883658074420967*^9, 3.883658089245864*^9}, {3.8857187542556796`*^9, 
   3.8857188018659673`*^9}, {3.885718836685726*^9, 3.885718967085741*^9}, {
   3.885719083596223*^9, 3.8857191941971073`*^9}, {3.8857192320363903`*^9, 
   3.885719268966417*^9}, {3.885719309055955*^9, 3.8857194530365543`*^9}, {
   3.885719486781528*^9, 3.885719608321577*^9}, {3.885719867656763*^9, 
   3.885719880586302*^9}, {3.8857199204212837`*^9, 3.8857199250263996`*^9}, {
   3.8857200073269978`*^9, 3.8857200204864945`*^9}, {3.8857320300434446`*^9, 
   3.8857320648132424`*^9}, 3.8857327507785597`*^9, {3.885732870753117*^9, 
   3.8857328976595163`*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"b7dc6190-5aa6-4900-b259-09367d859ddb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solve system using Gauss-Seidel method", "Section",
 CellChangeTimes->{{3.8833989828495893`*^9, 
  3.8833989945035477`*^9}},ExpressionUUID->"f6bc9c63-f06f-46b3-a305-\
6ddd19b3668f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"solutionH", "=", "None"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "tol", ",", "maxIterations", ",", "mat", ",", "rhs", ",", "i", ",", "j", 
      ",", "k", ",", "\[Phi]", ",", "lastPhi", ",", "iter", ",", 
      "toleranceMet", ",", "mainIdx", ",", "newValue", ",", "hi", ",", 
      "kCurr", ",", "kPrev", ",", "crit", ",", "elapseT", ",", "hRem", ",", 
      "mRem", ",", "sRem", ",", "tTotal"}], "}"}], ",", 
    RowBox[{
     RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"hi", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.0", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "t"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", "n"}], ",", 
          RowBox[{"i", "++"}], ",", 
          RowBox[{
           RowBox[{"hi", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "i"}], "]"}], "]"}], "=", 
           RowBox[{"hNorm", "[", 
            RowBox[{"xCoord", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Phi]", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.0", ",", "2", ",", "numNodes"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tol", "=", 
         RowBox[{"N", "[", 
          SuperscriptBox["10", 
           RowBox[{"-", "6"}]], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"maxIterations", "=", "150"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tTotal", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"hRem", "=", "99"}], ";", "\[IndentingNewLine]", 
        RowBox[{"mRem", "=", "99"}], ";", "\[IndentingNewLine]", 
        RowBox[{"sRem", "=", "99"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"k", "=", "2"}], ",", 
          RowBox[{"k", "\[LessEqual]", "t"}], ",", 
          RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"kCurr", "=", 
            RowBox[{"1", "+", 
             RowBox[{"Mod", "[", 
              RowBox[{"k", ",", "2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"kPrev", "=", 
            RowBox[{"1", "+", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"k", "-", "1"}], ",", "2"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"elapseT", "=", 
            RowBox[{
             RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Note", ":", " ", 
                RowBox[{
                 RowBox[{
                 "mat", " ", "is", " ", "not", " ", "actually", " ", "a", " ", 
                  RowBox[{"matrix", ".", " ", "It"}], " ", "only", " ", 
                  "contains", " ", "the", " ", "non"}], "-", 
                 RowBox[{
                 "zero", " ", "elements", " ", "from", " ", "the", " ", 
                  "real", " ", "matrix"}]}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"mat", "=", 
                RowBox[{"buildMatrix", "[", "k", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"rhs", "=", 
                RowBox[{"buildRightSide", "[", 
                 RowBox[{"k", ",", 
                  RowBox[{"\[Phi]", "[", 
                   RowBox[{"[", "kPrev", "]"}], "]"}], ",", 
                  RowBox[{"hi", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"\[Phi]", "[", 
                 RowBox[{"[", "kCurr", "]"}], "]"}], "=", 
                RowBox[{"\[Phi]", "[", 
                 RowBox[{"[", "kPrev", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"iter", "=", "0"}], ";", "\[IndentingNewLine]", 
               RowBox[{"toleranceMet", "=", "False"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"lastPhi", "=", "0"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"Solve", " ", "for", " ", "\[Phi]"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"While", "[", 
                RowBox[{
                 RowBox[{"iter", "<", "maxIterations"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"lastPhi", "=", 
                   RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", "kCurr", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{"Update", " ", "left", " ", "to", " ", "right"}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"For", "[", 
                   RowBox[{
                    RowBox[{"j", "=", "m"}], ",", 
                    RowBox[{"j", "\[GreaterEqual]", "1"}], ",", 
                    RowBox[{"j", "--"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"For", "[", 
                    RowBox[{
                    RowBox[{"i", "=", "1"}], ",", 
                    RowBox[{"i", "\[LessEqual]", "n"}], ",", 
                    RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"mainIdx", "=", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"newValue", "=", 
                    RowBox[{"rhs", "[", 
                    RowBox[{"[", "mainIdx", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", ">", "1"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "leftIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "j"}], "]"}], "]"}]}], 
                    "]"}], "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", "<", "n"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "rightIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}]}], 
                    "]"}], "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"j", ">", "1"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "bottomIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}], "]"}]}], "]"}], 
                    "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"j", "<", "m"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "topIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], "]"}], 
                    "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", "mainIdx"}], "]"}], "]"}], "=", 
                    RowBox[{"newValue", "/", 
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "centerIdx"}], "]"}], "]"}]}]}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{"Update", " ", "right", " ", "to", " ", "left"}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"For", "[", 
                   RowBox[{
                    RowBox[{"j", "=", "m"}], ",", 
                    RowBox[{"j", "\[GreaterEqual]", "1"}], ",", 
                    RowBox[{"j", "--"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"For", "[", 
                    RowBox[{
                    RowBox[{"i", "=", "n"}], ",", 
                    RowBox[{"i", "\[GreaterEqual]", "1"}], ",", 
                    RowBox[{"i", "--"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"mainIdx", "=", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"newValue", "=", 
                    RowBox[{"rhs", "[", 
                    RowBox[{"[", "mainIdx", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", ">", "1"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "leftIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "j"}], "]"}], "]"}]}], 
                    "]"}], "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", "<", "n"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "rightIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}]}], 
                    "]"}], "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"j", ">", "1"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "bottomIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}], "]"}]}], "]"}], 
                    "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"j", "<", "m"}], ",", 
                    RowBox[{"newValue", "-=", 
                    RowBox[{
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "topIdx"}], "]"}], "]"}], 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", 
                    RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], "]"}], 
                    "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", "mainIdx"}], "]"}], "]"}], "=", 
                    RowBox[{"newValue", "/", 
                    RowBox[{"mat", "[", 
                    RowBox[{"[", 
                    RowBox[{"mainIdx", ",", "centerIdx"}], "]"}], "]"}]}]}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"iter", "++"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"crit", "=", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", "kCurr", "]"}], "]"}], "-", "lastPhi"}]}], 
                    ";"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"crit", "=", 
                   RowBox[{"calcResid", "[", 
                    RowBox[{"mat", ",", 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", "kCurr", "]"}], "]"}], ",", "rhs"}], "]"}]}],
                   ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Max", "[", 
                    RowBox[{"Abs", "[", "crit", "]"}], "]"}], "<", "tol"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"toleranceMet", "=", "True"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Update", " ", "the", " ", "free", " ", "surface", " ", 
                 "height"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"For", "[", 
                RowBox[{
                 RowBox[{"i", "=", "1"}], ",", 
                 RowBox[{"i", "\[LessEqual]", "n"}], ",", 
                 RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"hi", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "i"}], "]"}], "]"}], "=", 
                   RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    FractionBox["2", 
                    RowBox[{"\[Tau]", " ", "g"}]], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kCurr", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "m"}], "]"}], "]"}]}], "]"}], "]"}], 
                    "-", 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"[", 
                    RowBox[{"kPrev", ",", 
                    RowBox[{"index", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "m"}], "]"}], "]"}]}], "]"}], "]"}]}], 
                    ")"}]}], "+", 
                    RowBox[{"hi", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"k", "-", "1"}], ",", "i"}], "]"}], "]"}]}], 
                    ")"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
              "\[IndentingNewLine]", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"tTotal", "+=", "elapseT"}], ";", "\[IndentingNewLine]", 
           RowBox[{"tRem", "=", 
            RowBox[{
             RowBox[{"tTotal", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"t", "-", "1"}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{"k", "-", "1"}], ")"}]}]}], "-", "tTotal"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"hRem", "=", 
            RowBox[{"Floor", "[", 
             RowBox[{"tRem", "/", "3600"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"mRem", "=", 
            RowBox[{"Floor", "[", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{"tRem", ",", "3600"}], "]"}], "/", "60"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"sRem", "=", 
            RowBox[{"Floor", "[", 
             RowBox[{"Mod", "[", 
              RowBox[{"tRem", ",", "60"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"toleranceMet", "\[Equal]", "False"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"myPrint", "[", 
               RowBox[{
               "\"\<Could not meet tolerance (``) for time index `` after `` \
iterations, Max resid was: ``\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"tol", ",", "k", ",", "iter", ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"Abs", "[", "crit", "]"}], "]"}]}], "}"}]}], "]"}],
               ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{
              RowBox[{"myPrint", "[", 
               RowBox[{
               "\"\<Tolerance met (``) for time index `` in `` iterations, \
Max resid was: ``\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{"tol", ",", "k", ",", "iter", ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"Abs", "[", "crit", "]"}], "]"}]}], "}"}]}], "]"}],
               ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"myPrint", "[", 
         RowBox[{"\"\<Done!\>\"", ",", 
          RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"solutionH", "=", "hi"}], ";"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", ",", 
       RowBox[{"Row", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"k", "-", "1"}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{"t", "-", "1"}], ")"}]}], "]"}], ",", 
           RowBox[{"StringForm", "[", 
            RowBox[{"\"\<``/``, Time remaining: ``h, ``m, ``s\>\"", ",", 
             RowBox[{"(", 
              RowBox[{"k", "-", "1"}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"t", "-", "1"}], ")"}], ",", "hRem", ",", "mRem", ",", 
             "sRem"}], "]"}]}], "}"}], ",", "\"\< \>\""}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}], "\n", 
 RowBox[{"ListPlot3D", "[", 
  RowBox[{"solutionH", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ",", 
   RowBox[{"DataRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "l"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "tMax"}], "}"}]}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8833994253081355`*^9, 3.883399477858903*^9}, {
   3.883399595132308*^9, 3.8833998337865095`*^9}, {3.88339990957773*^9, 
   3.8834001478141375`*^9}, {3.883400188632965*^9, 3.8834001976029263`*^9}, {
   3.883400229795764*^9, 3.883400233066886*^9}, {3.883400285117941*^9, 
   3.8834004576278563`*^9}, {3.8834005074389725`*^9, 3.88340052367028*^9}, {
   3.8834005539554815`*^9, 3.8834006779333153`*^9}, {3.8834007616772313`*^9, 
   3.883400847779869*^9}, {3.883400880912042*^9, 3.883400908600379*^9}, {
   3.883400943005*^9, 3.8834009440135646`*^9}, {3.883401112891464*^9, 
   3.8834012320165462`*^9}, {3.8834013176648073`*^9, 3.883401320572117*^9}, {
   3.883401445370432*^9, 3.8834014686863174`*^9}, {3.88340157118721*^9, 
   3.883401639647879*^9}, {3.883402498331817*^9, 3.883402505623869*^9}, {
   3.883402561741702*^9, 3.883402571550256*^9}, {3.883402639798582*^9, 
   3.883402642911746*^9}, {3.883402746804392*^9, 3.88340276608484*^9}, {
   3.8834034870839396`*^9, 3.8834035274459558`*^9}, {3.8834035746695147`*^9, 
   3.8834036618941545`*^9}, {3.8834037040083413`*^9, 3.883403852346835*^9}, {
   3.8834040532061863`*^9, 3.8834040819258375`*^9}, {3.8834042393899994`*^9, 
   3.883404286083604*^9}, {3.883404427765421*^9, 3.8834044403538017`*^9}, {
   3.8834051430687037`*^9, 3.8834051431875134`*^9}, {3.8834054936971483`*^9, 
   3.8834054937560763`*^9}, 3.8834055449215384`*^9, {3.8834060300375466`*^9, 
   3.88340603038811*^9}, {3.883406969139033*^9, 3.883407058767334*^9}, {
   3.883407131335684*^9, 3.883407242177696*^9}, {3.8834073497976723`*^9, 
   3.8834073540241966`*^9}, {3.8834085638734293`*^9, 
   3.8834085665118055`*^9}, {3.8834105672441454`*^9, 3.883410588653318*^9}, {
   3.883410655066318*^9, 3.883410687687462*^9}, {3.8834107345047975`*^9, 
   3.8834107671224575`*^9}, {3.883410797194929*^9, 3.88341079722616*^9}, {
   3.8834124821986265`*^9, 3.8834124852915564`*^9}, {3.8835732053910294`*^9, 
   3.8835732430914516`*^9}, {3.883573274220817*^9, 3.8835732976716623`*^9}, 
   3.8835734060306535`*^9, 3.883577773369475*^9, {3.8836538434235015`*^9, 
   3.883654139573268*^9}, {3.8836549272918878`*^9, 3.88365493384171*^9}, {
   3.883654987851873*^9, 3.8836550660117645`*^9}, {3.8836552078213596`*^9, 
   3.8836553184417906`*^9}, {3.8836554535111237`*^9, 3.883655483060786*^9}, {
   3.883655516640848*^9, 3.8836555255509024`*^9}, {3.883655564280771*^9, 
   3.88365556964078*^9}, {3.8836556202305026`*^9, 3.883655723863577*^9}, {
   3.883655858640315*^9, 3.883655870670514*^9}, {3.883656845768484*^9, 
   3.8836568571283617`*^9}, {3.883657072408074*^9, 3.8836570798289423`*^9}, {
   3.883657758172387*^9, 3.883657772536709*^9}, {3.8836581078494225`*^9, 
   3.883658113344865*^9}, 3.8836581622870407`*^9, {3.883658197431514*^9, 
   3.8836581990245028`*^9}, 3.8836589839527445`*^9, {3.8836590265137186`*^9, 
   3.8836590910818415`*^9}, {3.88365912477605*^9, 3.883659234826402*^9}, {
   3.883659307424219*^9, 3.883659310651447*^9}, {3.8836606060889444`*^9, 
   3.883660712799254*^9}, {3.883660744158794*^9, 3.8836609378117805`*^9}, {
   3.8836611406726947`*^9, 3.8836611751479177`*^9}, {3.8836612965909777`*^9, 
   3.883661349017333*^9}, {3.8836614431772738`*^9, 3.883661443397606*^9}, {
   3.8836617033469553`*^9, 3.8836617038068347`*^9}, {3.8836618629464602`*^9, 
   3.8836618737367363`*^9}, {3.8836620793463755`*^9, 3.883662095195967*^9}, {
   3.8836623264758515`*^9, 3.8836623637355814`*^9}, {3.8854581072686977`*^9, 
   3.885458118642828*^9}, {3.885481385894268*^9, 3.885481405417592*^9}, {
   3.885481640469123*^9, 3.885481653108469*^9}, {3.8854821271744037`*^9, 
   3.885482140040968*^9}, {3.8854824967101173`*^9, 3.8854825188721695`*^9}, {
   3.885482577077897*^9, 3.885482639991087*^9}, {3.885719652646555*^9, 
   3.8857196834562716`*^9}, {3.8857197200165453`*^9, 
   3.8857197510764866`*^9}, {3.8857202518265095`*^9, 
   3.8857203324370246`*^9}, {3.8857215498375936`*^9, 
   3.8857215565173287`*^9}, {3.8857215914175167`*^9, 3.885721591487358*^9}, {
   3.8857240490553994`*^9, 3.885724050496082*^9}, {3.885724177224229*^9, 
   3.885724178066481*^9}, {3.8857262436759515`*^9, 3.885726272661271*^9}, {
   3.8857302957352467`*^9, 3.8857302987656827`*^9}, {3.8857306583483033`*^9, 
   3.885730661478423*^9}, {3.8857313343753076`*^9, 3.8857313445002565`*^9}, {
   3.8857320745832057`*^9, 3.885732107722065*^9}, {3.8857321638472347`*^9, 
   3.8857321876136837`*^9}, {3.8857322226529884`*^9, 
   3.8857323151255836`*^9}, {3.8857329147173295`*^9, 3.8857329526891565`*^9}, 
   3.8857331156107025`*^9, {3.8857391622889757`*^9, 3.885739162751285*^9}, {
   3.8857392221453614`*^9, 3.8857392812671556`*^9}, {3.885740018956931*^9, 
   3.8857400339517555`*^9}, {3.8857902273543606`*^9, 
   3.8857902405767975`*^9}, {3.885790372758027*^9, 3.885790373992901*^9}, {
   3.885820394759912*^9, 3.885820503534221*^9}},
 CellLabel->
  "In[1383]:=",ExpressionUUID->"a4c123cd-a0e9-43a4-95ad-ebbf1d7530b7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"finiteSol", "=", 
   RowBox[{"buildInterpolation", "[", 
    RowBox[{"solutionH", ",", "xCoord", ",", "tCoord"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nF", "=", "20"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"Number", " ", "of", " ", "fourier", " ", "coefficients"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"coeff", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      FractionBox["2", "l"], 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"hInitial", "[", "x", "]"}], 
         RowBox[{"Cos", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"i", " ", "\[Pi]"}], "l"], "x"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "0", ",", "l"}], "}"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "nF"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"omega", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     SqrtBox[
      RowBox[{
       FractionBox[
        RowBox[{"i", " ", "\[Pi]"}], "l"], "g", " ", 
       RowBox[{"Tanh", "[", 
        RowBox[{
         FractionBox[
          RowBox[{"i", " ", "\[Pi]"}], "l"], "h"}], "]"}]}]], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "nF"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"basis", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"i", " ", "\[Pi]"}], "l"], "x"}], "]"}], 
      RowBox[{"Cos", "[", 
       RowBox[{
        RowBox[{"omega", "[", 
         RowBox[{"[", "i", "]"}], "]"}], " ", "time"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "nF"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Show", "[", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"hNorm", "[", "x", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "0", ",", "l"}], "}"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ",", 
        RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "]"}], ","}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"finiteSol", "[", 
        RowBox[{"x", ",", "t"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "l"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"basis", ".", "coeff"}], "/.", 
        RowBox[{"{", 
         RowBox[{"time", "\[Rule]", "t"}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "l"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", 
     RowBox[{"4", "\[Pi]"}], ",", 
     RowBox[{"AnimationRate", "\[Rule]", 
      RowBox[{"1", "/", "50"}]}], ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Open\>\""}]}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.8835740440601654`*^9, 3.8835740954291897`*^9}, {
  3.8835741280489483`*^9, 3.883574129714016*^9}, {3.88357419041899*^9, 
  3.8835742368290186`*^9}, {3.8835759587163954`*^9, 3.8835760763461237`*^9}},
 CellLabel->
  "In[1344]:=",ExpressionUUID->"78cb9d6b-ebb8-4cda-b0a6-78ae96c2a8a7"]
}, Open  ]]
},
WindowSize->{1920, 1117},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.5 Inherited,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 161, 3, 99, "Section",ExpressionUUID->"42108651-6b61-4a1e-bd67-8bc5b7bfbc1c"],
Cell[CellGroupData[{
Cell[766, 29, 11737, 273, 1395, "Input",ExpressionUUID->"a11c82e2-ee0a-4188-940e-f76bf6862d06"],
Cell[CellGroupData[{
Cell[12528, 306, 2970, 44, 34, "Print",ExpressionUUID->"732b2cef-b81b-464a-bf2d-44d83ed024d0"],
Cell[15501, 352, 3020, 45, 34, "Print",ExpressionUUID->"9f40f3fe-65ad-4da2-b6da-a1222a797fec"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[18582, 404, 224, 4, 99, "Section",ExpressionUUID->"6d7d3f2f-12aa-4bbe-9371-8bdcba80fc8b"],
Cell[18809, 410, 24096, 521, 3060, "Input",ExpressionUUID->"b7dc6190-5aa6-4900-b259-09367d859ddb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42942, 936, 187, 3, 99, "Section",ExpressionUUID->"f6bc9c63-f06f-46b3-a305-6ddd19b3668f"],
Cell[43132, 941, 25774, 534, 2571, "Input",ExpressionUUID->"a4c123cd-a0e9-43a4-95ad-ebbf1d7530b7"],
Cell[68909, 1477, 3877, 115, 516, "Input",ExpressionUUID->"78cb9d6b-ebb8-4cda-b0a6-78ae96c2a8a7"]
}, Open  ]]
}
]
*)

